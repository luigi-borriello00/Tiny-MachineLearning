#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class SVM {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float kernels[14] = { 0 };
                        float decisions[3] = { 0 };
                        int votes[3] = { 0 };
                        kernels[0] = compute_kernel(x,   1.49399270603  , 1.482523522224  , 1.485257597927  , 1.4941036774  , 1.503150088964  , 1.500133379518  , 1.505185316479  , 1.497012111962  , 1.495314333881  , 1.499154288026  , 1.495937579214  , 1.497372245715  , 1.498774769723  , 1.484985185352  , 1.506074587568  , 1.50037471817  , 1.51613653558  , 1.514973160231  , 1.514517721653  , 1.502342732806  , 1.502927202535  , 1.505129479205  , 1.492523051612  , 1.491027350819  , 1.488529326983  , 1.476938758488  , 1.48797153945  , 1.478637507432  , 1.489566572898  , 1.473038191239  , 1.477019316144  , 1.464399559556 );
                        kernels[1] = compute_kernel(x,   0.936516964677  , 0.951187281993  , 0.94543911626  , 0.940346509232  , 0.959042741035  , 0.956255393724  , 0.942647470257  , 0.943253628344  , 0.981519873268  , 0.954938000303  , 0.947963201648  , 0.950184429335  , 0.942909957566  , 0.963888259899  , 0.949011039217  , 0.939973007012  , 0.946332407136  , 0.952059238007  , 0.966837992361  , 0.945365925796  , 0.942554366508  , 0.944419480268  , 0.944837096686  , 0.967069002726  , 0.949800410764  , 0.948915825877  , 0.944788049752  , 0.952134390361  , 0.95585160507  , 0.970841371694  , 0.962519391581  , 0.959216955698 );
                        kernels[2] = compute_kernel(x,   0.998068782321  , 0.989873408697  , 1.000449834618  , 0.999959321307  , 0.995008049557  , 0.997573772389  , 0.998973423581  , 0.992612377457  , 0.995250044802  , 0.987310756251  , 0.990942928285  , 0.998324859058  , 0.996229333749  , 0.993078598701  , 0.998167415825  , 1.001177875462  , 0.995496062008  , 0.993944140183  , 0.998879197032  , 0.987083182333  , 0.984241975579  , 0.990747220296  , 0.992124119579  , 0.98721596359  , 1.003664151612  , 0.986164813085  , 0.987656825195  , 0.996106605715  , 0.990425161544  , 1.000323947831  , 0.998537333944  , 0.990149937505 );
                        kernels[3] = compute_kernel(x,   -1.26791430575  , -1.275657011362  , -1.268730827518  , -1.285240509582  , -1.264593988911  , -1.261114512388  , -1.254729119643  , -1.267718563907  , -1.262928383781  , -1.269041785873  , -1.252308614734  , -1.268800675794  , -1.258508628896  , -1.277463541472  , -1.258185966263  , -1.273578267662  , -1.24903015585  , -1.258190624395  , -1.254255575903  , -1.266242998731  , -1.253012080048  , -1.258485178752  , -1.264599193773  , -1.268350776448  , -1.264824051569  , -1.268864914521  , -1.25913774192  , -1.267213468783  , -1.266518287995  , -1.252165414401  , -1.230901874669  , -1.230113357307 );
                        kernels[4] = compute_kernel(x,   -2.071528506255  , -2.093861691143  , -2.071685441347  , -2.106303819896  , -2.082138733562  , -2.107974807531  , -2.144099541477  , -2.238680901873  , -2.29954489279  , -2.382721685269  , -2.378612801464  , -2.377290780096  , -2.342547020868  , -2.32671957112  , -2.318614939942  , -2.363224096577  , -2.346213736857  , -2.415295266711  , -2.451400364751  , -2.53258460766  , -2.510618743749  , -2.537229324455  , -2.544638044944  , -2.472234712274  , -2.547659558021  , -2.543076899924  , -2.513849214223  , -2.518682108878  , -2.506369526321  , -2.489794423521  , -2.47748319998  , -2.464190108094 );
                        kernels[5] = compute_kernel(x,   -0.841157330468  , -0.853559628909  , -0.82602989221  , -0.838442483079  , -0.806208552897  , -0.842488960947  , -0.829403449323  , -0.843272222727  , -0.778985604445  , -0.829377509951  , -0.825995882292  , -0.814869189244  , -0.814382982348  , -0.845384517827  , -0.822120965092  , -0.827756832019  , -0.813788220784  , -0.837356860533  , -0.822047462733  , -0.84596164054  , -0.823458387666  , -0.852865423263  , -0.833148087656  , -0.862481092143  , -0.829224353335  , -0.849280457689  , -0.833717703313  , -0.84562771535  , -0.832379742092  , -0.82446831396  , -0.796373799471  , -0.817224807981 );
                        kernels[6] = compute_kernel(x,   -0.852774992341  , -0.82868504744  , -0.85683864732  , -0.821727967693  , -0.834445683694  , -0.825405952485  , -0.84447868922  , -0.812036852982  , -0.839924682436  , -0.82080186984  , -0.829571813828  , -0.819738223664  , -0.825890431551  , -0.813954951619  , -0.843820420188  , -0.801017618872  , -0.824840603983  , -0.808178870401  , -0.839797399771  , -0.808964720153  , -0.836558576051  , -0.828097724465  , -0.841273753975  , -0.815971375105  , -0.826261790396  , -0.801877841502  , -0.832655124391  , -0.820065657086  , -0.834428969446  , -0.797063100911  , -0.81289194301  , -0.778280890733 );
                        kernels[7] = compute_kernel(x,   -2.835220612999  , -2.826816591715  , -2.853317093244  , -2.872076247011  , -2.842554675564  , -2.863679802145  , -2.832016187604  , -2.862850544981  , -2.80458636905  , -2.786313461707  , -2.746488186286  , -2.730427525879  , -2.703060275056  , -2.704161446055  , -2.660587800727  , -2.65763015914  , -2.639982878698  , -2.627058123167  , -2.632015962012  , -2.661108045951  , -2.668312118668  , -2.707567397275  , -2.719345601169  , -2.70182993616  , -2.711263950749  , -2.713281383895  , -2.683107753513  , -2.678248210198  , -2.662202390801  , -2.661473644457  , -2.608834751828  , -2.622961463027 );
                        kernels[8] = compute_kernel(x,   -0.874198281955  , -0.896420269287  , -0.861862561966  , -0.886018092716  , -0.88048173793  , -0.890626766377  , -0.869096235223  , -0.887093272589  , -0.861572586222  , -0.869389551164  , -0.866793490963  , -0.871109400931  , -0.868241053863  , -0.899803485405  , -0.874224889248  , -0.87245573071  , -0.873512279064  , -0.881990744579  , -0.855264386707  , -0.883484312653  , -0.870194194878  , -0.655686130144  , -0.433019190353  , -0.59375955449  , -0.310020900193  , -0.455764587617  , -0.555881879098  , -0.865224152699  , -0.841011683013  , -0.828554555639  , -0.762475893375  , -0.803110302681 );
                        kernels[9] = compute_kernel(x,   -0.633117462375  , -0.644534944312  , -0.715262897385  , -0.778669174971  , -0.885936246726  , -1.039724233373  , -1.118868674977  , -1.190396721879  , -1.285960746529  , -1.383802349285  , -1.37973973406  , -1.227075914954  , -1.052864551621  , -0.754253704006  , -0.645233705076  , -0.799941640261  , -1.06699763339  , -1.155177946956  , -0.923684401241  , -0.353320843681  , -0.056577699686  , 0.253627510997  , 0.340615299799  , 0.529353383693  , 0.619526116167  , 0.848086867546  , 0.873183941089  , 0.749371718472  , 0.280671260634  , -0.958378334573  , -1.897590926801  , -2.614423197102 );
                        kernels[10] = compute_kernel(x,   0.096857047225  , 0.116077546844  , 0.095720803777  , 0.104425851908  , 0.104510685161  , 0.118418784503  , 0.102626693922  , 0.11677489812  , 0.113143732789  , 0.105321586369  , 0.114097096449  , 0.123685885529  , 0.104012326088  , 0.109157934149  , 0.109315528953  , 0.119344724068  , 0.112049096467  , 0.117075956655  , 0.100047497915  , 0.117021222356  , 0.116454431119  , 0.102649942788  , 0.100134543287  , 0.11015923209  , 0.09996807055  , 0.106689414947  , 0.108801226289  , 0.106898299583  , 0.101529866027  , 0.121827643156  , 0.12295101836  , 0.118023855231 );
                        kernels[11] = compute_kernel(x,   0.01119829448  , 0.021972738632  , -0.002979619799  , 0.032317277302  , 0.004503701789  , 0.022292420357  , 0.00743273986  , 0.02933874589  , -0.005496391075  , 0.029842250633  , 0.006979096198  , 0.014321644183  , 0.001740444384  , 0.022356293313  , -0.011648611058  , 0.022460862733  , 0.000358242648  , 0.015911142547  , -0.006908714329  , 0.021471560807  , -0.015015724504  , 0.011025495521  , -0.009063409725  , 0.005681214021  , -0.022949695251  , 0.007982450987  , -0.024912334215  , 0.004148178725  , -0.0040110668  , 0.01539132009  , -0.00777699341  , 0.033987571686 );
                        kernels[12] = compute_kernel(x,   0.124301336329  , 0.109189024282  , 0.12591017215  , 0.096641794331  , 0.121172774135  , 0.120496757979  , 0.119970093013  , 0.108422583133  , 0.134093686188  , 0.099509334948  , 0.123579598605  , 0.120741551774  , 0.11749117097  , 0.100304373482  , 0.125532774992  , 0.103124918833  , 0.116740066562  , 0.114076030383  , 0.123402077451  , 0.091476546092  , 0.128698024797  , 0.09217923201  , 0.104042656424  , 0.091649211796  , 0.111406537496  , 0.078863908116  , 0.108949758826  , 0.093335922396  , 0.103865298319  , 0.11543575673  , 0.134208751053  , 0.109160215178 );
                        kernels[13] = compute_kernel(x,   0.029020452971  , 0.021938238519  , 0.016485181922  , 0.029795196791  , 0.014115120446  , 0.034243637971  , 0.021305168063  , 0.028629371192  , 0.049023831725  , 0.029830831671  , 0.012143061227  , 0.020244681348  , 0.019093311009  , 0.027512257956  , 0.011289502152  , 0.025894837024  , 0.009408382514  , 0.014747673042  , 0.009791065662  , 0.016854089124  , -0.009898998788  , -0.00020130597  , -0.008799812652  , -0.01083700446  , -0.022297702635  , -0.002000049414  , -0.008733713206  , -0.00733820801  , -0.008727724174  , 0.004079963934  , 0.000623792014  , 0.021836530955 );
                        decisions[0] = -0.383666091154
                        + kernels[0] * 0.84798039119
                        + kernels[1] * 0.859071423599
                        + kernels[3] * -0.309990303094
                        + kernels[4] * -0.262817316917
                        + kernels[5] * -0.121361175514
                        + kernels[6] * -0.108533033196
                        + kernels[7] * -0.411005731265
                        + kernels[9] * -0.493344254803
                        ;
                        decisions[1] = 0.058622548288
                        + kernels[0] * 0.260845203518
                        + kernels[1]
                        + kernels[2] * 0.1845367053
                        + kernels[10] * -0.445381908817
                        - kernels[12]
                        ;
                        decisions[2] = 0.541654655815
                        + kernels[4] * 0.222621285011
                        + kernels[6] * 0.735651983631
                        + kernels[7] * 0.290892054716
                        + kernels[8] * 0.207271826182
                        + kernels[9] * 0.478060260584
                        - kernels[11]
                        + kernels[13] * -0.934497410123
                        ;
                        votes[decisions[0] > 0 ? 0 : 1] += 1;
                        votes[decisions[1] > 0 ? 0 : 2] += 1;
                        votes[decisions[2] > 0 ? 1 : 2] += 1;
                        int val = votes[0];
                        int idx = 0;

                        for (int i = 1; i < 3; i++) {
                            if (votes[i] > val) {
                                val = votes[i];
                                idx = i;
                            }
                        }

                        return idx;
                    }

                protected:
                    /**
                    * Compute kernel between feature vector and support vector.
                    * Kernel type: rbf
                    */
                    float compute_kernel(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float kernel = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            kernel += pow(x[i] - va_arg(w, double), 2);
                        }

                        return exp(-0.05 * kernel);
                    }
                };
            }
        }
    }