#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[3] = { -2.795350049216 ,-2.152757959335 ,-1.344513562453  };
                        votes[0] += dot(x,   0.240515415066  , 0.237298039186  , 0.24369950343  , 0.233453634845  , 0.240657178963  , 0.231599311725  , 0.234159299634  , 0.226486158424  , 0.226813486299  , 0.222956893043  , 0.227121683649  , 0.221151598273  , 0.227776425111  , 0.232266999804  , 0.230246868654  , 0.226044361872  , 0.22484961098  , 0.215938648474  , 0.225649962153  , 0.229164012362  , 0.232511765962  , 0.248648362606  , 0.259314918533  , 0.257176704988  , 0.257582540138  , 0.249387079792  , 0.260569995458  , 0.246742695884  , 0.255531681828  , 0.229222196184  , 0.223605358178  , 0.191592570033 );
                        votes[1] += dot(x,   -0.274366873864  , -0.275177613678  , -0.271724545157  , -0.281166665154  , -0.277713401159  , -0.285793385568  , -0.286652746696  , -0.291730578832  , -0.294147151546  , -0.298618250235  , -0.294584853712  , -0.294705775387  , -0.290616026761  , -0.281529432836  , -0.280021761085  , -0.285062680377  , -0.290798070274  , -0.297698999642  , -0.286637636933  , -0.273384184438  , -0.263100834268  , -0.246505350092  , -0.234936096556  , -0.233819386915  , -0.229561930969  , -0.232337012291  , -0.223951338881  , -0.238893230881  , -0.242819952809  , -0.283080340315  , -0.302672420693  , -0.337915831563 );
                        votes[2] += dot(x,   -0.03923339474  , -0.023092363753  , -0.0968208882  , 0.012010213467  , -0.078125057982  , -0.010605381442  , -0.035416913445  , 0.026368695706  , 0.022756332712  , 0.053690359616  , -0.00131968944  , 0.071937695426  , 0.047739837999  , 0.03055546445  , 0.055392033668  , 0.078251375299  , 0.060397937527  , 0.138682347222  , 0.061889148199  , 0.086862019718  , 0.066899068844  , -0.052859223745  , -0.15746521803  , -0.116955856197  , -0.107634025605  , 0.006769049711  , -0.120489593841  , 0.015217464415  , -0.12153188387  , 0.013866132555  , -0.035895668627  , 0.225045274528 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 3; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }