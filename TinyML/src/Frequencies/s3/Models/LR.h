#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[6] = { -0.018468775575 ,0.029460347917 ,-0.000618067535 ,0.015562322749 ,-0.023680144177 ,-3.87684534951  };
                        votes[0] += dot(x,   0.020068662355  , -0.025136624475  , 0.010479514671  , 0.018684915165  , -0.012865524492  , -0.013698276254  , -0.016736385384  , 0.026284078457  , 0.008499438023  , -0.014768839556  , 0.027741557153  , -0.022771886267  , 0.00264712512  , -0.009589806659  , -0.003537440871  , 0.020497435147  , -0.029355655305  , 0.016022849254  , 0.005651704595  , -0.011125163218  , 0.009945187401  , -0.012997008456  , 0.001781186608  , 0.012856381897  , -0.010540077987  , 0.010005461765  , -0.022881557248  , 0.016146772988  , -0.007269514487  , 0.006544082596  , 0.01467629295  , -0.015579864164 );
                        votes[1] += dot(x,   0.008675409261  , 0.010096078029  , -0.009846447485  , -0.031855255593  , 0.027629259625  , 0.038818002041  , -0.03106658942  , -0.00971115696  , 0.001815144605  , -0.020215305696  , -0.018903355081  , 0.037023075536  , 0.005935359905  , -0.001702426102  , -0.004787732768  , 0.008452509626  , 0.02587292  , -0.027553014672  , -0.012527306975  , 0.004979826246  , -0.036720396277  , 0.051194721152  , 0.010314505652  , -0.025837640504  , 0.002041588401  , 0.000726316726  , 0.017233169227  , -0.05130780846  , 0.026413403262  , 0.009511215638  , -0.002094547223  , -0.003129929167 );
                        votes[2] += dot(x,   -0.002142982864  , 0.004838322281  , -0.006212465004  , -0.004320702379  , 0.01486001387  , -0.016986667921  , 0.017832220391  , 0.007001334226  , -0.004674952273  , 0.004174395792  , -0.018834413253  , 0.002488062974  , -0.005535562585  , 0.014120196024  , 0.00374753089  , -0.022402997236  , 0.003267199252  , 0.006655286645  , -0.008680894501  , -0.002884778022  , 0.027598690612  , -0.015489721363  , 0.015984196588  , -0.016553655942  , 0.005497836894  , 0.016784795348  , -0.034917120583  , 0.033313178875  , -0.015762625306  , -0.014357742173  , 0.00214681421  , 0.009072351246 );
                        votes[3] += dot(x,   -0.009460070076  , 0.00530410098  , -0.022225536737  , 0.0209432702  , -0.010010350688  , 0.003488551321  , 0.025505125609  , -0.027869015283  , 0.014616163467  , 0.006842110463  , 0.010064733202  , -0.005751191136  , -0.013311486289  , -0.007980555848  , -0.00646571592  , 0.004937108412  , -0.01748048875  , 0.024702504304  , 0.016800036345  , -0.027785766001  , 0.022708092085  , -0.005474640592  , -0.011154510809  , 0.00844914116  , 0.001142283781  , 0.006246049671  , 0.003151732942  , -0.017222601567  , 0.011622583323  , 0.009299156634  , -0.012019859621  , -0.002063380598 );
                        votes[4] += dot(x,   0.024199660533  , -0.027336763371  , 0.025532694448  , -0.009982950885  , -0.010286499256  , -0.014738237311  , -0.014891581592  , 0.03148096582  , -0.01003570491  , 0.009265671529  , 0.007486172671  , -0.022726202535  , 0.010042212695  , -0.006487099089  , 0.017614108796  , -0.017003779737  , 0.011813297373  , 0.005679737659  , -0.014630683103  , 0.028747152743  , -0.011078678762  , -0.009501459269  , -0.001372621287  , 0.008095556173  , 0.000583269422  , -0.034515407864  , -0.018499580568  , 0.034564969853  , -0.020670677063  , 0.004326156826  , 0.008095605596  , 0.015873529121 );
                        votes[5] += dot(x,   -0.011414618983  , 0.007506712225  , 0.002700061842  , -0.002358886431  , 0.015875151591  , -0.010406094176  , 0.005174711096  , -0.013744510657  , -0.011829904309  , 0.021499063173  , 0.002339577448  , -0.003058612073  , -0.010985538831  , 0.014514422811  , -0.012129898053  , 0.002954615599  , 0.002612665589  , -0.014673367197  , 0.004338989506  , -0.010306260494  , 0.01668712713  , 0.011124190931  , -0.005284773738  , 0.006334856219  , 0.009094160476  , -0.017328826631  , 0.000509213297  , 0.006065815663  , -0.005547896312  , -0.004968714911  , -0.009369295126  , 0.014612857008 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 6; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }