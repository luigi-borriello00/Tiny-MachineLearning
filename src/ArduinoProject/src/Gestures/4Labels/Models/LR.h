#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[4] = { 0.244881043962 ,-1.017760862068 ,0.197674505124 ,0.575205312982  };
                        votes[0] += dot(x,   0.161123911337  , -0.634948112  , 0.056413976256  , 0.355273664424  , 0.852638430379  , 0.778113702354  , 0.219939320144  , -0.029826312929  , -1.121042898668  , 0.168780115277  , -0.97411975335  , -0.629536498403  , -0.606416351413  , -1.251145761813  , 1.101144325527  , -0.250498882603  , 1.540410660345  , 0.51714317428  , -0.708254900129  , 1.074943279351  , 0.614749107883  , -0.704892243773  , 0.057287249918  , -0.543607885603  , -0.147355171083  , 0.017628182969  , 0.184217960856  , 0.086110530768  , -0.819511003842  , 0.605920998091  , 0.301478188033  , -0.619041234856  , -0.495724098142  , 0.648321833586  , 0.140903012775  , -0.367944893628  , 0.933620783982  , 0.82539380256  , -0.211176228899  , 1.025697151222  , 1.063886744045  , -0.368173657127 );
                        votes[1] += dot(x,   0.225823671179  , -0.690529971367  , -0.693204760124  , 0.105123419831  , -1.162465625482  , -0.148256300586  , 0.508497281724  , -0.10312710505  , 0.191213323347  , 0.128715362726  , 0.225262899598  , 0.352861497965  , 0.626690953775  , 0.264731236952  , -1.189416819098  , 0.434163903194  , -3.076056118036  , -0.285982735437  , 0.050204872667  , -1.050012562745  , 0.573580580263  , -0.344392548112  , 0.378804802172  , 0.675099596934  , -0.857364678062  , -1.217606837473  , 0.813981916978  , -0.609734237331  , -1.462153202831  , 0.949607229196  , -0.057034872181  , -1.208464821426  , 0.070863266686  , 0.609154679304  , -0.45872079852  , -0.340633326403  , 0.425009972962  , -0.316204182383  , -0.014382059329  , 0.532625284875  , -0.030310822817  , 0.159769424531 );
                        votes[2] += dot(x,   -1.069575273816  , 1.263955400716  , 0.311640548553  , -1.02390416995  , 0.893608099282  , -0.250808641631  , -1.228144040571  , -0.051273449918  , 1.293036918752  , -0.719153050428  , 0.103063054952  , 0.834233432923  , -0.226338955035  , 0.201730868656  , 0.344939426367  , 0.54526930146  , 1.431121206949  , -1.955999748363  , 1.208350009921  , 0.611526140223  , -2.852278890789  , 0.485269688701  , 1.089287758941  , -0.589206048376  , -0.767220898527  , 1.175352724429  , 1.468847927868  , -1.557515733703  , 0.846079697917  , 0.863311648413  , -1.464300069094  , 0.524420325186  , 0.213685109315  , -1.428776505063  , 0.127021818967  , -0.282307383492  , -1.141487489925  , 0.470310848646  , -0.117976552014  , -1.306892018445  , 0.072417358566  , 0.195945642767 );
                        votes[3] += dot(x,   0.682627691299  , 0.061522682651  , 0.325150235315  , 0.563507085696  , -0.583780904178  , -0.379048760137  , 0.499707438703  , 0.184226867897  , -0.363207343431  , 0.421657572425  , 0.6457937988  , -0.557558432485  , 0.206064352673  , 0.784683656205  , -0.256666932796  , -0.728934322051  , 0.104524250743  , 1.72483930952  , -0.550299982458  , -0.636456856829  , 1.663949202643  , 0.564015103184  , -1.525379811032  , 0.457714337045  , 1.771940747673  , 0.024625930075  , -2.467047805703  , 2.081139440265  , 1.435584508756  , -2.4188398757  , 1.219856753242  , 1.303085731096  , 0.211175722141  , 0.171299992173  , 0.190795966778  , 0.990885603524  , -0.217143267019  , -0.979500468823  , 0.343534840241  , -0.251430417653  , -1.105993279794  , 0.012458589829 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 4; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 42);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 42; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }