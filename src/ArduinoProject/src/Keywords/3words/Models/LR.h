#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[3] = { 0.007558193703 ,-0.532578126493 ,-1.05669187656  };
                        votes[0] += dot(x,   -0.001106112669  , 0.000950897671  , 0.000425917175  , -0.000514841216  , -0.000553195472  , -1.9236886e-05  , 0.000155231096  , 0.000796273824  , 0.000429801839  , -0.000428627535  , 0.000439562952  , -0.000677282201  , 0.001085993003  , -0.001020197615  , -0.000155491864  , 0.002712524333  , -0.002287025911  , -0.000917566003  , -0.003315204549  , -0.000384043143  , 0.002331932764  , 0.000201373029  , -0.000110646827  , -0.001440470483  , 0.005523022635  , -0.006175744088  , 0.004992781577  , -0.008358412192  , 0.00693196912  , 0.000742675339  , -0.004078190611  , 0.002271976305 );
                        votes[1] += dot(x,   -6.2900164e-05  , -0.000133872964  , -0.000372009461  , 0.000591551071  , -4.9513479e-05  , -0.000199646455  , -0.00014830816  , 0.000216529015  , -0.001097797842  , -0.000330673243  , -0.000375778299  , 0.000279084699  , 0.000391266761  , 0.000657553402  , -0.000368605188  , -0.001195558716  , 0.002073080995  , 0.001006283651  , -0.0016021761  , -3.9181989e-05  , 0.001770156737  , -0.000493726011  , -0.00095935328  , 0.001942282428  , -0.000671679606  , -0.001994629799  , -0.001741123065  , 0.004598133414  , -0.001082507365  , -0.001915189006  , 1.3259936e-05  , 0.00229961554 );
                        votes[2] += dot(x,   0.000942461532  , -0.000708834178  , -0.000151025826  , -9.1293591e-05  , 0.00079195073  , 0.000167686477  , -0.000201801514  , -0.000912054278  , 0.000420512677  , 0.000803632103  , -0.000228331567  , 0.000361239521  , -0.000910471819  , -0.000205345441  , 0.000140413865  , 9.1938292e-05  , -0.00054425725  , -0.00019808237  , 0.001453619293  , 0.000322022029  , -0.001506123979  , -0.000401302458  , 0.001162213767  , -0.00159559048  , -0.0017091978  , 0.005705363903  , -0.003382163754  , 0.002284925087  , -0.003237294628  , 0.001078985552  , 0.004252806486  , -0.004954045158 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 3; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }