#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[5] = { 0.036706787748 ,-0.275605346427 ,-0.692023024126 ,0.90430957705 ,0.026612005754  };
                        votes[0] += dot(x,   0.180311084132  , -0.167224274572  , 0.421866247044  , 0.39859803915  , -1.079246284812  , 0.682432450833  , 0.211094373073  , -1.767225468356  , -1.718498869301  , 0.153514515537  , 1.586931113585  , -2.445005034955  , -0.451253790523  , 2.334458275567  , 1.897738593819  , -1.172327865115  , 0.235374845725  , 2.049366322339  , -0.799365580726  , -1.547137030708  , 0.502458452357  , -0.154890816752  , -0.77534784403  , -0.934064433127  , 0.189178709058  , -0.19833774533  , -0.956029742491  , -0.002568797257  , 0.128821009682  , 0.199854155058  , -0.307307448202  , -0.313763424354  , 0.416534429818  , -0.297801277235  , -0.554820065539  , -0.011292433655  , -0.269364019573  , -0.269865547153  , 0.007139230768  , -0.264309431542  , -0.263845184717  , 0.049889467602 );
                        votes[1] += dot(x,   0.167178561567  , -0.571534887849  , 0.010118253138  , 0.096945728294  , 1.087511424059  , 0.54282968673  , -0.008208723778  , 0.432135114514  , -0.629037860041  , -0.080619152806  , -1.314934268996  , 0.056598808264  , -0.557567368648  , -1.559530090699  , 0.588204711303  , 0.099907952697  , 1.427846095586  , -0.090848722676  , -0.579417134598  , 1.668138231247  , 0.402136907683  , -0.919124924452  , 0.61093721076  , 0.051961683413  , -0.286943394538  , 0.083597836188  , 0.489745080068  , 0.161691225646  , -0.85616966669  , 0.358268099475  , 0.495793830474  , -0.321620003274  , -0.421824950435  , 0.806559794398  , 0.312996824393  , -0.402900646741  , 1.062371736496  , 0.908667539856  , -0.223204781102  , 1.104592572097  , 1.110473696678  , -0.186462170785 );
                        votes[2] += dot(x,   0.023571091065  , -0.884236577315  , -0.45905895935  , -0.191030173065  , -0.873251623395  , -0.23921667221  , 0.22602809105  , 0.144727973622  , 0.665234698411  , -0.045945503606  , 0.035023889385  , 0.706695170185  , 0.622312185717  , -0.22732264138  , -1.832701918251  , 0.623013420407  , -2.885616252713  , -0.687577933017  , 0.178177239616  , -0.625035355487  , 0.320967048379  , -0.503513679843  , 0.061685888723  , 1.060916606151  , -1.088983375212  , -1.529634803978  , 0.854130649489  , -0.837095558174  , -1.734384928667  , 0.932099619202  , -0.0787865741  , -1.098015403747  , -0.006563427913  , 0.638936582911  , -0.219436405646  , -0.310146465741  , 0.492597176995  , -0.11072111708  , -0.061412894854  , 0.516152551097  , 0.054302630615  , 0.005860870636 );
                        votes[3] += dot(x,   -1.035540610044  , 1.378180580954  , 0.022825281244  , -0.916340176842  , 1.328539739463  , -0.328226958506  , -1.089059247888  , 0.346906107488  , 1.408035005818  , -0.58333097418  , -0.546957317527  , 0.925637000602  , -0.084287114564  , -0.115981062593  , 0.570683416956  , 0.531007085181  , 1.121209676687  , -2.473748211116  , 1.354067457922  , 0.837493320408  , -2.901428713921  , 0.688487028801  , 1.360819488987  , -0.586214414756  , -0.707511200426  , 1.373527950816  , 1.54973771467  , -1.538917166207  , 0.840008568221  , 0.729605665751  , -1.544685845248  , 0.213809093557  , 0.229888524329  , -1.520259373512  , 0.028210423503  , -0.232088621759  , -1.247675551155  , 0.227456587973  , -0.155922268565  , -1.257176909764  , 0.155508774154  , 0.205093412804 );
                        votes[4] += dot(x,   0.66447987328  , 0.244815158783  , 0.004249177924  , 0.611826582463  , -0.463553255314  , -0.657818506848  , 0.660145507543  , 0.843456272732  , 0.274267025113  , 0.556381115054  , 0.239936583552  , 0.756074055904  , 0.470796088018  , -0.431624480895  , -1.223924803827  , -0.081600593171  , 0.101185634715  , 1.202808544471  , -0.153461982214  , -0.333459165459  , 1.675866305503  , 0.889042392246  , -1.25809474444  , 0.407400558319  , 1.894259261118  , 0.270846762304  , -1.937583701737  , 2.216890295992  , 1.621725017454  , -2.219827539486  , 1.434986037077  , 1.519589737818  , -0.218034575799  , 0.372564273438  , 0.433049223289  , 0.956428167896  , -0.037929342763  , -0.755537463596  , 0.433400713754  , -0.099258781888  , -1.05643991673  , -0.074381580258 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 5; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 42);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 42; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }