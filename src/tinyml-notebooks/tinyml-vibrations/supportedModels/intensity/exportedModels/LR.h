#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[5] = { -0.850863452146 ,-0.032542048864 ,1.023835151815 ,-0.992131892794 ,-2.580730355854  };
                        votes[0] += dot(x,   0.927074470685  , -0.101426971767  , 0.028914933265  , 0.755554751851  , 0.113664474404  , 0.257834294627  , 0.8708227333  , 0.170543644289  , -0.232568317403  , 0.739789249154  , 0.112266795478  , 0.171199036981  , 1.07523906022  , 0.055099665623  , 0.259845114029  , 1.143130688289  , -0.11389603128  , 0.040354777287  , 1.305540295131  , 0.028510415621  , -0.017083550779  , 0.962048129454  , -0.196836933738  , -0.103820174204  , 0.945073334955  , -0.031828536981  , 0.135647093983  , 0.787864285282  , -0.239657011446  , -0.07023899283  , 1.019862795189  , -0.233947917076  , 0.137194181587  , 0.577949921363  , -0.137364787667  , -0.001657971546  , 0.613208880495  , -0.425625089919  , -0.227572538185  , 0.921785419105  , 0.121942215521  , -0.07413842029  , 0.779788152622  , 0.290403994367  , 0.054347422779  , 0.862142097517  , -0.124956759889  , -0.324420889229  , 0.707919864702  , -0.244451671922  , -0.093971364653  , 0.21794518542  , -0.081323276981  , 0.099063982202  , 0.612230128319  , 0.043186378537  , -0.051622169719  , 1.233958272985  , -0.214050577954  , -0.005917521996 );
                        votes[1] += dot(x,   1.744451911743  , 0.185247267664  , 0.421916162555  , 1.43142770412  , 0.119521626959  , 0.567226800838  , 1.225315901707  , 0.001616134384  , -0.152518983994  , 1.467679507162  , 0.176702875249  , 0.549537665448  , 1.588387993248  , 0.208345971373  , 0.552268810473  , 1.345640268041  , -0.008199584218  , 0.281393695495  , 1.557729752174  , -0.26108900921  , 0.138810197102  , 2.13566187378  , -0.316648195026  , -0.249075606202  , 1.940966726137  , -0.587494000003  , -0.338204275824  , 2.099444696373  , -0.063028298031  , -0.246885950547  , 1.851741578136  , -0.506421513702  , -0.39357385602  , 2.457603398425  , -0.673469776198  , -0.182393367852  , 2.068249139946  , -0.184096005969  , -0.242120968436  , 1.914362932754  , -0.209035680389  , -0.197632007077  , 2.017884261779  , -0.188537439249  , -0.449557962091  , 1.851313900069  , 0.09258381028  , -0.284930645161  , 1.406517064624  , -0.67174993328  , -0.476117160207  , 1.311917552293  , -0.148809754309  , 0.293401414936  , 1.189147077286  , -0.193411906553  , -0.02333090713  , 1.707834997758  , -0.563511459707  , 0.083320782761 );
                        votes[2] += dot(x,   0.577610086281  , 3.951065163652  , -0.499496486838  , 0.457351522539  , 2.932042801062  , -0.508251907571  , 0.845589670771  , 2.538037756117  , -0.191981404438  , 0.605485588385  , 3.026496582973  , -0.696173799792  , 0.732231788929  , 3.644351245875  , -0.312606740265  , 1.052061382956  , 3.921915181101  , -0.336826333701  , 1.107901635782  , 4.388741929229  , -0.371344165285  , 1.151739785479  , 5.42611609831  , -0.42699431114  , 1.187826015099  , 5.859864566082  , -0.246214161476  , 0.981238593735  , 5.52717376582  , -0.422506983627  , 0.899928304551  , 5.335829462902  , -0.271806066638  , 0.744413097439  , 6.192665085073  , -0.173458933826  , 0.9207505113  , 5.45685865319  , -0.455403864837  , 1.089298187608  , 4.869887178682  , -0.255507477947  , 1.379215033617  , 3.665530287348  , 0.024066484571  , 1.315442451679  , 3.523310920127  , 0.611536659046  , 1.192165756448  , 3.337302063135  , 0.356234458883  , 1.045225114691  , 2.895252495743  , -0.209960468797  , 1.40252364735  , 3.131809465749  , 0.35383139312  , 1.383115212148  , 3.985504456386  , -0.01310344051 );
                        votes[3] += dot(x,   -1.456857104928  , -1.452629575304  , -0.407241356233  , -0.791402293318  , -1.060387293564  , -0.199257905905  , -1.095619171302  , -0.739437484498  , 0.25024785826  , -0.814108480631  , -1.304066528155  , -0.169833868965  , -1.129030208268  , -1.293008932023  , -0.32859075242  , -1.24775899742  , -1.153790101443  , -0.108105843041  , -1.390589063201  , -1.244939195469  , 0.236820777161  , -1.558487005439  , -1.655176682463  , 0.432778095326  , -1.561701645953  , -1.750811890265  , 0.148729222288  , -1.54131466454  , -1.753118603466  , 0.322297237155  , -1.63946134262  , -1.365686187325  , 0.040658864906  , -1.67799317039  , -1.666915323476  , 0.122606019123  , -1.449104546089  , -1.662877871684  , 0.099991435802  , -1.748176212931  , -1.581470749416  , 0.172256395705  , -1.769092308975  , -1.271632481174  , -0.187110626725  , -1.579468441899  , -0.969875121268  , -0.266461039043  , -1.437802863452  , -0.493801144366  , -0.378803722409  , -1.037524426658  , -0.785989673539  , -0.260039566842  , -1.145872142055  , -0.752786471981  , -0.409336637673  , -1.76434590148  , -1.118111560081  , -0.279622675852 );
                        votes[4] += dot(x,   -1.821610680595  , -2.004590093309  , -0.130842180586  , -1.709870928039  , -1.305460480912  , -0.467459498156  , -1.561610543997  , -1.386280061737  , 0.35867991034  , -1.813177030659  , -1.517076705932  , -0.04155936473  , -1.940183496255  , -1.609107611992  , -0.465473846679  , -2.064150955746  , -1.628251325274  , -0.461266714402  , -2.122368957435  , -1.813215014143  , -0.088573385724  , -2.486248631619  , -2.189717978006  , 0.266183974708  , -2.390214943768  , -2.332410545113  , 0.537535385733  , -2.440288414756  , -1.944931468386  , 0.306423978432  , -1.946982693865  , -2.006420055017  , 0.457972865966  , -2.210009880042  , -2.578436039303  , 0.384786726987  , -2.312895691943  , -2.167877062248  , 0.567911060336  , -2.358996541664  , -1.803005712252  , 0.286753786079  , -2.197027195611  , -1.365977057698  , 0.293592227167  , -2.487996157125  , -1.493110422316  , -0.216191450549  , -1.745840037249  , -1.169079671769  , -0.17314210833  , -1.234673707212  , -0.772740539706  , -0.301023109347  , -1.918680420798  , -1.149539908102  , -0.623818418938  , -2.200922939136  , -1.385059921569  , -0.474661456558 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 5; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 60);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 60; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }