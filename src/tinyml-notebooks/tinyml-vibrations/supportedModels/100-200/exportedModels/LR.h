#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[3] = { 0.579730874416 ,-0.678221089088 ,0.098490214673  };
                        votes[0] += dot(x,   0.11299810717  , 2.712868410456  , -0.101079156118  , 0.124476288972  , 2.653223215783  , -0.12305342019  , 0.098231000735  , 2.668925220527  , -0.103784749263  , 0.078265162969  , 2.648845305231  , -0.091941323928  , 0.064953228529  , 2.634604961728  , -0.109833178981  , 0.069665467464  , 2.64772871573  , -0.101032027446  , 0.07824365686  , 2.674453979122  , -0.136956925312  , 0.096117194645  , 2.665301530992  , -0.124177090955  , 0.06486198404  , 2.635935187674  , -0.110553596818  , 0.120403967214  , 2.70206136884  , -0.084765415253  , 0.065837774311  , 2.689414028303  , -0.138931560644  , 0.071458637052  , 2.496014784536  , -0.073444576849  , 0.078404727489  , 2.715425816098  , -0.156659682384  , 0.075785759715  , 2.602168578801  , -0.134064532151  , 0.058301221195  , 2.57170844942  , -0.138748383253  , 0.059985233939  , 2.537988985258  , -0.109316244028  , 0.047676316691  , 2.606755130431  , -0.132789062947  , 0.048474533947  , 2.584424284882  , -0.107261831681  , 0.060743164142  , 2.602766134151  , -0.123647748906  , 0.03746025169  , 2.601563936906  , -0.112496349202 );
                        votes[1] += dot(x,   -2.624812336584  , -1.098429680217  , 0.016311016019  , -2.620695019288  , -1.066312957403  , 0.01604234587  , -2.603588467555  , -1.07858299951  , -0.003013084827  , -2.590037822948  , -1.069556731637  , -0.003025639538  , -2.598279795393  , -1.079968747362  , -0.002417822436  , -2.607696959037  , -1.064813523867  , 0.025984311148  , -2.616917978841  , -1.096021171489  , 0.000435641799  , -2.589125395748  , -1.073754971965  , 0.00231656139  , -2.594789210882  , -1.062179412503  , 0.016721523204  , -2.601823509904  , -1.092209018819  , 0.023700126908  , -2.566863772712  , -1.042741795195  , 0.018709164952  , -2.573439838598  , -1.056117301823  , 0.03818530596  , -2.589612318376  , -1.075161389184  , 0.034560962396  , -2.612420485927  , -1.094648508057  , 0.047053584998  , -2.605958606474  , -1.086102639563  , 0.058293154903  , -2.603299407793  , -1.051684851771  , 0.056586936945  , -2.602191387723  , -1.058409227801  , 0.083665573402  , -2.584365880233  , -1.077591630185  , 0.070793382226  , -2.586607647753  , -1.093067435282  , 0.052160210228  , -2.550468550276  , -1.113557855431  , 0.069505523852 );
                        votes[2] += dot(x,   2.511814229415  , -1.614438730239  , 0.084768140099  , 2.496218730317  , -1.58691025838  , 0.10701107432  , 2.505357466821  , -1.590342221017  , 0.10679783409  , 2.511772659979  , -1.579288573594  , 0.094966963467  , 2.533326566865  , -1.554636214366  , 0.112251001417  , 2.538031491573  , -1.582915191863  , 0.075047716298  , 2.538674321981  , -1.578432807633  , 0.136521283513  , 2.493008201103  , -1.591546559027  , 0.121860529566  , 2.529927226842  , -1.573755775171  , 0.093832073614  , 2.48141954269  , -1.609852350021  , 0.061065288345  , 2.501025998401  , -1.646672233108  , 0.120222395692  , 2.501981201546  , -1.439897482714  , 0.035259270889  , 2.511207590887  , -1.640264426914  , 0.122098719988  , 2.536634726212  , -1.507520070744  , 0.087010947153  , 2.547657385279  , -1.485605809856  , 0.08045522835  , 2.543314173853  , -1.486304133487  , 0.052729307083  , 2.554515071032  , -1.548345902631  , 0.049123489545  , 2.535891346287  , -1.506832654697  , 0.036468449455  , 2.525864483612  , -1.50969869887  , 0.071487538678  , 2.513008298585  , -1.488006081475  , 0.04299082535 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 3; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 60);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 60; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }