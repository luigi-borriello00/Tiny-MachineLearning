#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[3] = { 4.0668744e-05 ,-1.2193703e-05 ,-2.8475041e-05  };
                        votes[0] += dot(x,   -0.00060643494  , 0.000674505638  , 0.000322558055  , -0.000453177391  , -0.000314821985  , 4.292883e-05  , 0.000170997507  , 0.000360012293  , 0.000462007942  , -0.000157359839  , 0.000387982451  , -0.00056256061  , 0.00060353247  , -0.000728982255  , 3.022893e-05  , 0.002115949289  , -0.002047604433  , -0.000483104954  , -0.002545601523  , 0.000253806926  , 0.00131451401  , 0.000269186412  , 9.148834e-05  , -0.000897837161  , 0.00346399439  , -0.003342644544  , 0.001716329556  , -0.003115602575  , 0.002907150386  , 0.000408200794  , -0.001567928415  , 0.000730579047 );
                        votes[1] += dot(x,   8.3718989e-05  , -0.000226772896  , -0.000253873407  , 0.000501887851  , -8.9782095e-05  , -7.2313126e-05  , -0.000172252275  , 0.000250503769  , -0.000862502272  , -0.000250460299  , -0.000249044433  , 0.000331191956  , 6.4636102e-05  , 0.000621506873  , -4.17836e-05  , -0.001652207405  , 0.001924681125  , 0.000570210743  , 0.000187555541  , -5.3032054e-05  , 0.000498439066  , -0.000521604462  , -0.00061101793  , 0.001543588535  , -0.001505912127  , -0.000278019049  , -0.000656786767  , 0.002111273389  , -0.000481037425  , -0.001291781633  , -0.000315675455  , 0.001888621045 );
                        votes[2] += dot(x,   0.00052271595  , -0.000447732741  , -6.8684648e-05  , -4.8710461e-05  , 0.000404604079  , 2.9384296e-05  , 1.254768e-06  , -0.000610516062  , 0.00040049433  , 0.000407820138  , -0.000138938018  , 0.000231368654  , -0.000668168572  , 0.000107475381  , 1.155467e-05  , -0.000463741885  , 0.000122923308  , -8.7105788e-05  , 0.002358045982  , -0.000200774873  , -0.001812953076  , 0.00025241805  , 0.00051952959  , -0.000645751374  , -0.001958082263  , 0.003620663594  , -0.001059542789  , 0.001004329185  , -0.002426112961  , 0.000883580839  , 0.00188360387  , -0.002619200092 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 3; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }