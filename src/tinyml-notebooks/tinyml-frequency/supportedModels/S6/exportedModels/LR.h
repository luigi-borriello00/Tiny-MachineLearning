#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[11] = { 0.002103717866 ,0.006466762706 ,-0.000319037335 ,0.001629926383 ,-0.000291323718 ,-0.000351877308 ,-0.334034045503 ,-0.000465444268 ,-0.000765388491 ,-0.005125528506 ,-0.000862740458  };
                        votes[0] += dot(x,   -0.005445281642  , 0.010757663496  , -0.000747996634  , 0.001799572539  , -0.00126576629  , 0.0043625447  , 0.001889111855  , -0.005530928093  , -0.01668313757  , 0.011122293991  , -0.003800913944  , 0.008045430189  , -0.008953031992  , 0.001582743581  , 0.00915667987  , -0.007812422075  , 0.001882790847  , 0.000952886593  , 0.004161424093  , -0.002157508063  , 0.003940793488  , -0.017637457069  , 0.006212901193  , -0.003372027953  , 0.00601821714  , 0.004682625454  , -0.003070316469  , -0.000483579217  , 0.00314872852  , 0.000861778408  , -0.000847183924  , -0.003467144955 );
                        votes[1] += dot(x,   -0.000856674203  , 0.003100839995  , 0.000725378042  , 0.000748540375  , -0.00183856979  , 0.002868192893  , 0.001339928165  , -0.002597361296  , -0.00332757205  , -0.004647888323  , 0.000446074177  , 0.001197349288  , 0.005047111221  , 0.000941169701  , -0.000680369204  , -0.001052747937  , 0.000218665162  , -0.001178345792  , -0.001142015483  , -0.002677950588  , 0.001596301177  , 0.001448774724  , -0.001034631707  , 0.003828992886  , -0.002062136649  , 0.001546026736  , -0.000229415579  , -0.002528131797  , -0.002031247242  , -0.00077033747  , 0.003195465079  , -0.000183967423 );
                        votes[2] += dot(x,   -1.575282e-05  , -0.003209152318  , 0.003427413311  , 0.002238222674  , 0.001638385381  , -0.006727695218  , -0.001588949961  , 0.00193561006  , -0.000262988632  , 0.00284790028  , 0.001495744041  , 0.000764992397  , -0.004062858821  , -0.004860329135  , 0.000999663501  , 0.007465182147  , -0.002097815234  , -0.001564853265  , -0.000665441692  , 0.00065077671  , -0.003215475105  , 0.005591576213  , 0.000871163197  , -0.006280518771  , 0.003437280091  , -0.008450488875  , 0.009729742844  , -0.001591367912  , 0.003636697929  , 0.003986887584  , -0.007066104208  , 0.000351691548 );
                        votes[3] += dot(x,   -0.005905264251  , -0.001923722368  , 0.001404251885  , -0.000255017137  , -0.001211512488  , 0.003305592468  , 0.001041694875  , -0.001326573153  , -0.002076839418  , -0.001235094902  , 0.005415497012  , 7.4423231e-05  , 0.006238828097  , -0.000736639437  , 0.00097369106  , -0.002867626167  , -0.000891534715  , 0.001629828803  , -0.001349662532  , -0.001456453166  , -0.004831196962  , 0.004691475879  , -0.002051050237  , 0.003068300831  , -0.001963244561  , 0.000956875258  , -0.00089557204  , -0.000631097241  , 0.000266791996  , 0.003675982921  , -0.002538300468  , 0.000766370878 );
                        votes[4] += dot(x,   -1.8783816e-05  , 0.002440583184  , -0.001374810754  , -0.005353473483  , 0.005885287278  , -0.001299434779  , -0.002638429152  , 0.006066712762  , 0.006709019109  , 0.000169930024  , -0.001286179276  , -0.00695134802  , -0.010084335594  , 0.000364756029  , -0.000106448355  , 0.005628423108  , 0.008956067623  , -0.003475858574  , -0.001653137551  , -0.004297449325  , 0.002911384103  , 0.002586855518  , 0.002161068935  , 0.00199074997  , -0.007197274481  , -0.004661711229  , 0.000859747447  , 0.004144853998  , 0.002078617067  , -0.007460790252  , -0.005498680471  , 0.009792120679 );
                        votes[5] += dot(x,   0.002388272612  , -0.000585834913  , 0.001858694496  , -0.000500025859  , 0.002020474576  , 0.001262328693  , -0.002058849808  , -0.002672429398  , -0.002663451069  , -0.004330083191  , 0.002799044382  , -0.003249512555  , 0.002905627267  , 0.001994743105  , -0.000691031902  , -0.000530995641  , 0.000616957203  , -0.000414457599  , 0.001614647495  , -0.002201747952  , -0.001777317043  , 0.003744760753  , -0.001257978968  , 0.002109149147  , -0.002231926509  , 0.002650068147  , -0.000399454053  , -0.001795621152  , -0.00255410595  , 1.1075018e-05  , 0.002296217614  , 0.001109736375 );
                        votes[6] += dot(x,   0.00319140343  , 0.000611971205  , -0.000917772358  , 0.001628301417  , -0.003554645273  , -0.002497805455  , 0.002792436014  , -0.008452864708  , 0.005199664326  , -0.002916609535  , 0.003503785636  , -0.002138532027  , 0.00091661892  , 0.003311838474  , -0.00285660053  , 0.00461172339  , -0.003058976849  , 0.001308888206  , 0.007052705779  , -0.010462493134  , 0.00120502794  , -0.000187634908  , -0.00527358873  , 0.003079565533  , -0.000262532553  , 0.003048596986  , 0.002241588235  , -0.000768160918  , -0.002283380187  , 0.000700888367  , -0.000611083524  , 0.001409454784 );
                        votes[7] += dot(x,   -0.001291653244  , 0.001747687859  , 0.002334476512  , -0.001152607551  , 1.1988764e-05  , 0.002510965898  , 0.002146696353  , -0.001819506625  , -0.001766571629  , -0.005461968863  , 0.002270412246  , -0.001677185594  , 0.001002649765  , 1.606107e-06  , 0.000692899469  , -0.001228347863  , 0.002805970065  , -0.001448379718  , 0.001419385598  , -0.001084269769  , 0.002109125147  , 0.00183029166  , -0.002507460773  , 0.003462691068  , -0.003551860651  , 0.002590368164  , -0.000932204179  , -0.002762243303  , -0.002345248005  , -0.000809884855  , 0.003226958807  , -0.000854256368 );
                        votes[8] += dot(x,   0.000732343899  , -0.005570995449  , 0.001339666756  , 0.000490275372  , 0.009401957779  , -0.002135936297  , -0.000958998811  , 0.002677692581  , 0.000501567479  , -0.012052575948  , -0.000287943369  , -0.000232232796  , 0.007896916441  , 0.001020546733  , -0.002361874752  , 0.006206974796  , -0.003924705499  , 0.002796392353  , -0.007983155766  , 0.010789006864  , -0.010721707237  , -0.002187502023  , 0.004333370072  , -0.001334223495  , 0.003690893519  , -0.004411765841  , 0.000200856822  , 0.009375447739  , -0.002346365213  , -0.003257539789  , 0.001839589574  , -0.004101193053 );
                        votes[9] += dot(x,   0.000695558055  , 0.002791087347  , 0.000229678757  , -0.003282221561  , -0.003258681222  , 0.001615977977  , 0.002162700167  , -0.002468194084  , -0.001401843073  , -0.000413733501  , 0.003242743785  , -4.2084487e-05  , 0.002105903042  , 0.001693176745  , 0.000582847151  , 0.001579560705  , -0.001281696063  , -0.003871460382  , -0.002409092319  , -0.001922298572  , 0.001206178217  , 0.003142871711  , -0.003227262342  , 0.004784961929  , -0.003666205698  , 0.003603639485  , -0.000785704591  , -0.002407758649  , -0.003902663329  , 0.001442942085  , 0.002964355551  , -2.79793e-06 );
                        votes[10] += dot(x,   0.009666768569  , -0.007974918471  , 0.001960467577  , 0.001029365437  , -0.005676320502  , 0.002759280395  , -0.001822457528  , 0.005799333547  , 0.000315438484  , -0.005218614818  , -0.006020360631  , 0.005247151785  , 0.002603665048  , -0.00152043702  , 0.002017515175  , -0.003253854338  , -0.005696321735  , 0.000352875564  , 0.001244134413  , 0.012644324759  , 0.002438049812  , -0.008180678121  , 0.0007971623  , -0.003214703629  , -0.000205322811  , 0.006434741089  , -0.000730238904  , -0.00020716718  , -0.005459611103  , -0.004440063759  , 0.006943820067  , -0.003187483171 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 11; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }