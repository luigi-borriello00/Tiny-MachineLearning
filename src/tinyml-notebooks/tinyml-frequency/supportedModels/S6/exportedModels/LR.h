#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[11] = { 0.000309698002 ,0.000299079979 ,-1.7776211e-05 ,0.000399567952 ,2.3303769e-05 ,-2.1160714e-05 ,-0.00034747813 ,-4.8293117e-05 ,-0.000158153048 ,-0.000243622404 ,-0.000195166078  };
                        votes[0] += dot(x,   -0.003554732224  , 0.007492469822  , -0.001411537325  , 0.002632456934  , 0.00223779237  , -0.000480357109  , 0.000241789644  , -0.004528556199  , -0.010243822623  , 0.008389987695  , -0.004727216116  , 0.005040412208  , -0.007763015644  , 0.001768725916  , 0.005715515288  , -0.007928607206  , 0.003276892304  , 0.002877035195  , 0.002762355192  , -0.001406969897  , 0.000596331271  , -0.010334482952  , 0.003212758467  , -0.001902684365  , 0.006478921486  , 0.002559125164  , -0.003201541574  , 0.001106501554  , 0.003090146181  , 0.002762043049  , -0.001990100362  , -0.002854494635 );
                        votes[1] += dot(x,   -7.9838908e-05  , 0.002426942901  , -0.000199659708  , 0.000546221337  , -0.001070377492  , 0.002263087963  , -2.193409e-06  , -0.001695544366  , -0.002321833884  , -0.002001079254  , -0.000576568134  , 0.001601722076  , 0.004237286187  , 0.000685514493  , -0.000717358113  , -0.001241263784  , -0.000506812018  , -0.00070554454  , -0.001689871835  , -0.001682219142  , 0.001836696847  , 0.000942039044  , -0.000364048593  , 0.002186451923  , -0.000402932441  , 0.000804825211  , -0.000836001229  , -0.001349456586  , -0.00062124425  , -0.000376990306  , 0.001008548425  , -0.00010977266 );
                        votes[2] += dot(x,   -0.000947867012  , -0.004091324633  , 0.003088921223  , 0.003053538731  , 0.000548494741  , -0.006035392782  , -0.00131614185  , 0.001971210804  , 0.001187344591  , 0.004795831074  , 0.000353504626  , -0.001589317568  , -0.004833913356  , -0.003223685567  , 0.002166550643  , 0.007436752862  , -4.3035574e-05  , -0.00150587703  , -0.000862731379  , 0.000352638448  , -0.00245350169  , 0.004098508388  , -0.000936442231  , -0.006260071962  , 0.003104584637  , -0.00637911303  , 0.008138109206  , -0.0021789363  , 0.004871030349  , 0.004020765543  , -0.00394638184  , -0.002600073031 );
                        votes[3] += dot(x,   -0.00538864551  , -0.001859552574  , -0.001960677921  , -0.00040926849  , -0.001656416603  , 0.002783882116  , 0.0002450027  , 0.000360606692  , -0.000263836841  , 0.002285289573  , 0.004580031073  , 0.002330970462  , 0.00503756398  , 0.00040970259  , -0.001926818711  , -0.004253627281  , -0.003367296534  , 9.0219182e-05  , -0.001419477954  , -0.00035213753  , -0.001317422985  , 0.003912099936  , 0.000116868429  , 0.002299055035  , -0.001066319761  , 0.000737600052  , -0.001958620725  , -0.000626524875  , -4.1052739e-05  , 0.002502793721  , -0.001619194786  , 0.001740748782 );
                        votes[4] += dot(x,   0.00014887435  , 0.001805687399  , -0.000364991016  , -0.002601653589  , 0.00396418699  , -0.000880328485  , -0.001007249612  , 0.006863887623  , 0.006351406957  , -0.000155369885  , -0.00335574617  , -0.006845150467  , -0.009089906908  , -0.00239144352  , 0.000382154946  , 0.004452755261  , 0.009902442994  , -0.000503255961  , 0.000690556264  , -0.003342912064  , 0.001680383521  , 0.000312640813  , 0.002590796652  , 0.001130964703  , -0.007322144888  , -0.004748924403  , -0.00071314758  , 0.001768062759  , 0.001466467343  , -0.005138217525  , -0.002873561337  , 0.007787242431 );
                        votes[5] += dot(x,   0.001919349811  , 0.000251549871  , 0.001389816349  , 3.4766471e-05  , 0.001290931533  , 0.000158968875  , -0.002155099765  , -0.002536304779  , -0.002435134021  , -0.002600531157  , 0.001319090742  , -0.002605763624  , 0.001953666929  , 0.001218157327  , -0.000540268226  , -0.000707450189  , 0.000727353715  , 0.000211932452  , 0.001210534623  , -0.001219709307  , -0.000607956909  , 0.002511344919  , -0.000130782232  , 0.000954033502  , -0.000966377736  , 0.001603582906  , -0.000451338327  , -0.001853469263  , -0.001093696342  , 0.000324431599  , 0.001474247052  , 0.001385866782 );
                        votes[6] += dot(x,   0.002625546911  , 0.000861982234  , -0.001016811949  , -0.000506120755  , -0.003080218242  , -0.003528123615  , 0.002211236504  , -0.007332488764  , 0.006339282392  , -0.001456323609  , 0.00223744668  , -0.001304112921  , 0.000829108636  , 0.002457785204  , -0.002743889672  , 0.005465702183  , -0.00194304782  , 0.001139109391  , 0.00543264663  , -0.008270107987  , -0.000246028542  , -0.000272127019  , -0.004712975007  , 0.000423952698  , 0.001143275316  , 0.002391677231  , 0.002036134266  , -0.000108898831  , -0.000146174212  , 0.000971152211  , -0.000503996421  , 0.000659756782 );
                        votes[7] += dot(x,   -0.001286557267  , 0.001440979946  , 0.001537971127  , -0.000499470292  , 0.001554366401  , 0.002699787421  , 0.002920502767  , -0.000784974389  , -0.001267239585  , -0.004136163112  , -0.000422511446  , -0.002333717657  , -0.000324859816  , -0.000632306956  , 0.000993863195  , -0.000613801517  , 0.003370224184  , 0.000474831972  , 0.002037842989  , -0.000447128632  , 0.002273278461  , 0.000792686004  , -0.001703098474  , 0.00159081323  , -0.002560236346  , 0.000409923534  , -0.001231723856  , -0.002185129901  , -0.000984218286  , -0.00090852628  , 0.001398802859  , -0.001141248413 );
                        votes[8] += dot(x,   -0.00128814955  , -0.004901188384  , -8.0586423e-05  , 0.002585643323  , 0.007829035348  , 0.0006461852  , 0.000592904838  , 0.001145822455  , -0.000109371927  , -0.008352057747  , -0.000435337338  , -0.001302941624  , 0.003672114082  , 0.001815235906  , -0.001047029184  , 0.005356531302  , -0.000908618807  , 0.001867355998  , -0.006356651565  , 0.0071554402  , -0.006590709432  , -0.001917701876  , 0.001974066616  , -0.001715601763  , 0.003263773825  , -0.00389533641  , 0.000563143567  , 0.007528101062  , -1.106952e-06  , -0.002590636678  , 0.000572026908  , -0.005067821511 );
                        votes[9] += dot(x,   0.000346707381  , 0.002132131224  , -0.001811300993  , -0.003777270305  , -0.004127989747  , 0.00074235526  , 0.001660523796  , -0.000248565306  , 0.001028680509  , 0.003414198462  , 0.002668219114  , 0.001484760876  , 0.002567335927  , 0.001266833895  , -0.000793775173  , -0.000442903036  , -0.004060861187  , -0.003603248037  , -0.003348429748  , -0.001768879653  , 0.000861465861  , 0.003320170935  , -0.001307749956  , 0.00423770578  , -0.002008791191  , 0.002742367443  , -0.001029720371  , -0.001554367325  , -0.002260132563  , 0.001670614958  , 0.00167600774  , 0.000384659625 );
                        votes[10] += dot(x,   0.007505312018  , -0.005559677805  , 0.000828856635  , -0.001058843365  , -0.0074898053  , 0.001629935155  , -0.003391275612  , 0.006784906231  , 0.001734524432  , -0.00018378204  , -0.001640913029  , 0.00552313824  , 0.003714619984  , -0.003374519289  , -0.001488944993  , -0.007524088595  , -0.006447241257  , -0.000342558623  , 0.001543226783  , 0.010981985563  , 0.003967463598  , -0.003365178194  , 0.001260606329  , -0.002944618782  , 0.0003362471  , 0.003774272304  , -0.001315293377  , -0.000545882294  , -0.004280018529  , -0.003237430291  , 0.004803601761  , -0.000184864153 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 11; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }