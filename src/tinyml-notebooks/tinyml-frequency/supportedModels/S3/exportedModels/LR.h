#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[6] = { -2.023677808157 ,-4.655261366457 ,-1.606521343455 ,-2.38211249368 ,-1.713058228028 ,-6.604572456533  };
                        votes[0] += dot(x,   0.391838398138  , 0.271232155875  , 0.390824885067  , 0.333775164087  , 0.243667472632  , 0.300648815518  , 0.172456510233  , 0.216262213372  , 0.205279033393  , -0.004583281145  , -0.007299288686  , 0.03764946564  , -0.042262069769  , -0.113746933228  , -0.065714834349  , -0.001036687362  , -0.258516190821  , -0.065616741093  , -0.130498056626  , -0.217644079177  , -0.169701350446  , -0.088134272103  , -0.070095241633  , 0.04006702931  , -0.020572529513  , -0.023030271087  , -0.079870724394  , 0.051435829411  , -0.014062557861  , -0.018213092772  , 0.069471822002  , -0.109405738833 );
                        votes[1] += dot(x,   0.026258763772  , -0.065706834389  , -0.049590309438  , -0.090038285978  , -0.019696019483  , -0.066812474907  , -0.193813403864  , -0.08465610116  , -0.168292526556  , -0.153118884734  , -0.265044395596  , -0.10228657128  , -0.155871856772  , -0.118257056603  , -0.209050558953  , -0.153945455175  , -0.228699528515  , -0.371327764269  , -0.299662596906  , 0.002172823057  , -0.115812634437  , 0.172871747751  , 0.201995030889  , 0.035924649784  , 0.025747960862  , 0.05209579323  , -0.046322316379  , -0.179044565691  , -0.165803831669  , -0.289474363326  , -0.370896050615  , -0.507652573477 );
                        votes[2] += dot(x,   0.114093278655  , 0.173838015574  , 0.048920587893  , 0.151537689836  , 0.120539643698  , 0.062539069072  , 0.056691144117  , 0.149162102231  , -0.015146512092  , 0.06510141283  , -0.098763622491  , -0.040397053912  , -0.065242705724  , 0.008139506826  , -0.041611176575  , -0.047273071744  , -0.053956414028  , 0.01229828317  , -0.01648182523  , 0.016989160858  , 0.080269666537  , -0.022521258673  , -0.034813589943  , -0.114585304591  , -0.124287846172  , -0.048440653158  , -0.278932637025  , -0.020201599736  , -0.160101235387  , -0.11446421591  , -0.15553580438  , 0.151646071373 );
                        votes[3] += dot(x,   -0.515264161774  , -0.300874852439  , -0.462703924891  , -0.273554864391  , -0.452493865673  , -0.396291942616  , -0.19372300414  , -0.238074259773  , -0.157586159286  , -0.08555685326  , -0.011943538132  , -0.175245610272  , -0.172941383197  , -0.208930855723  , 0.002957008074  , 0.126815270026  , 0.270208011657  , 0.543484249973  , 0.393122772489  , 0.043788279445  , 0.099831544585  , -0.208362496185  , -0.273061041768  , -0.045463623351  , 0.154906355053  , 0.18544775191  , 0.071376374739  , 0.063969155558  , -0.083952915486  , 0.10098532611  , 0.126682414629  , 0.394430863049 );
                        votes[4] += dot(x,   0.121429591331  , -0.263264245843  , 0.030846134012  , -0.145347520153  , -0.067969015068  , -0.139326062573  , 0.140123793051  , 0.095972484462  , 0.145752549204  , 0.328494339955  , 0.444194986091  , 0.168405988273  , 0.422960479803  , 0.16389571347  , 0.154369908534  , -0.054853692954  , 0.23170694234  , -0.098622688822  , -0.022970238467  , 0.191546215276  , 0.033170934923  , -0.448574874219  , -0.321390279778  , -0.512004678189  , -0.542965282914  , -0.330625719906  , -0.061534895968  , -0.199671276714  , 0.06337931702  , 0.301248021105  , 0.413070685524  , 0.372706340641 );
                        votes[5] += dot(x,   0.085450999517  , 0.221813880885  , 0.129843873409  , 0.126215778445  , 0.175075295338  , 0.13595239281  , 0.046395542499  , 0.098698004237  , 0.147107707898  , 0.070599294959  , 0.067739613011  , 0.187792030947  , 0.099754802329  , 0.178735206886  , 0.190453986557  , 0.180189662001  , 0.127040654473  , 0.240678807687  , 0.281252816615  , 0.162679010213  , 0.194716665563  , 0.319454028592  , 0.186090159014  , 0.261724158314  , 0.37460172341  , 0.233266511945  , 0.251066149699  , 0.373163990275  , 0.314105855104  , 0.236788166306  , 0.243520600791  , 0.347495425491 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 6; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }