#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[6] = { -16.795388040926 ,2.703924214301 ,14.638116900661 ,3.23770238128 ,14.761483791753 ,-18.545839247069  };
                        votes[0] += dot(x,   -1.082427329223  , -1.076379613995  , -1.073106888495  , -1.053809341268  , -1.035880715099  , -1.03891825122  , -1.035099495382  , -1.055113730113  , -1.066675408911  , -1.0644642435  , -1.062409671714  , -1.054589027031  , -1.040111599603  , -1.040952377265  , -1.043090551843  , -1.071930788085  , -1.092682835143  , -1.095594982849  , -1.116912492845  , -1.139433548884  , -1.150315159602  , -1.15051487816  , -1.170174053474  , -1.147823686905  , -1.159165900661  , -1.170649297087  , -1.160554656401  , -1.189895879689  , -1.217086820328  , -1.264784778033  , -1.352296665717  , -1.410104584468 );
                        votes[1] += dot(x,   -0.554146469954  , -0.506753654809  , -0.452216571223  , -0.462512480099  , -0.416908487225  , -0.422994828701  , -0.426255192131  , -0.462473011049  , -0.473515725348  , -0.487270424749  , -0.445796539518  , -0.474391748241  , -0.455972769694  , -0.464042384157  , -0.433302749522  , -0.435048178483  , -0.462233694506  , -0.512647484445  , -0.559363226294  , -0.547999734721  , -0.617678115645  , -0.628361829373  , -0.692342734793  , -0.675148465756  , -0.694711428074  , -0.665941222703  , -0.696224082077  , -0.718010179989  , -0.772466343905  , -0.857317348276  , -1.003576992561  , -1.110703674433 );
                        votes[2] += dot(x,   -0.020552645994  , -0.045510987312  , -0.060776904596  , -0.057934996542  , -0.051868252678  , -0.02497896061  , -0.052948040917  , -0.031534992683  , -0.063867325151  , -0.059387699195  , -0.07666891609  , -0.032345149422  , -0.018736822459  , -0.011580275437  , -0.050067941769  , -0.056115125311  , -0.088502473076  , -0.074036339722  , -0.074503667507  , -0.116062651014  , -0.110245807547  , -0.133905582336  , -0.089566798924  , -0.143005425398  , -0.130449075523  , -0.155488171979  , -0.139445569978  , -0.126138511382  , -0.167600051992  , -0.199758457756  , -0.298678290196  , -0.305374998291 );
                        votes[3] += dot(x,   0.536903322176  , 0.519421013903  , 0.526849076558  , 0.527814010797  , 0.534771050886  , 0.5140770146  , 0.514177129867  , 0.505708945521  , 0.503884507951  , 0.51223053368  , 0.533702487288  , 0.522870443392  , 0.517696452912  , 0.524453417081  , 0.513753762854  , 0.508436306151  , 0.525718757383  , 0.518241781284  , 0.531962387733  , 0.540544679156  , 0.533600240987  , 0.542118308715  , 0.565336108854  , 0.583223012489  , 0.580533079212  , 0.599570401608  , 0.624258020024  , 0.614604173506  , 0.617418706496  , 0.625210473105  , 0.630095353648  , 0.645969387448 );
                        votes[4] += dot(x,   -0.005657050537  , -0.020606768618  , -0.078158221397  , -0.079367917594  , -0.145774065654  , -0.145174173143  , -0.109932319601  , -0.063582820559  , -0.010629090875  , -0.016346026479  , -0.065196698353  , -0.083510214881  , -0.124495715193  , -0.143189311719  , -0.119414335102  , -0.085709111264  , -0.014312601122  , 0.026108525467  , 0.070555943856  , 0.110718371314  , 0.188551292142  , 0.20665247716  , 0.21863719356  , 0.20490927239  , 0.220645936906  , 0.201712665448  , 0.180131690269  , 0.223219850096  , 0.344792490665  , 0.495286885966  , 0.817352831794  , 0.959805096064 );
                        votes[5] += dot(x,   1.125880173531  , 1.129830010831  , 1.137409509153  , 1.125810724706  , 1.115660469771  , 1.117989199074  , 1.110057918164  , 1.106995608884  , 1.110803042334  , 1.115237860243  , 1.116369338386  , 1.121965696183  , 1.121620454037  , 1.135310931496  , 1.132121815382  , 1.140366896992  , 1.132012846463  , 1.137928500266  , 1.148261055057  , 1.15223288415  , 1.156087549665  , 1.164011503994  , 1.168110284778  , 1.177845293179  , 1.18314738814  , 1.190795624713  , 1.191834598163  , 1.196220547459  , 1.194942019064  , 1.201363224995  , 1.207103763033  , 1.220408773681 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 6; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }