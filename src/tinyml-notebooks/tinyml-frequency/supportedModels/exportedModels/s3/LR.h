#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[6] = { -1.929846206222 ,-4.464026302733 ,9.514143946318 ,3.997084059314 ,8.746178651468 ,-15.863534148145  };
                        votes[0] += dot(x,   0.60256016681  , 0.799640520502  , 0.652313252231  , 0.666940129127  , 0.777250538021  , 0.705322653037  , 0.511342452076  , 0.659300996921  , 0.719174248852  , 0.433604557229  , 0.494024791874  , 0.689343719053  , 0.466088083453  , 0.505586649778  , 0.544931315612  , 0.494811702715  , 0.334161622003  , 0.637058951861  , 0.681952187834  , 0.360121001339  , 0.418059897117  , 0.642828184555  , 0.366893583834  , 0.50120617066  , 0.704740329684  , 0.386628352743  , 0.44280252581  , 0.738185784942  , 0.631681318429  , 0.460930947606  , 0.508984342388  , 0.558791740001 );
                        votes[1] += dot(x,   -0.709891926905  , -0.734621686373  , -0.787874359835  , -0.789340010547  , -0.745877724188  , -0.796330671073  , -0.887473098445  , -0.775827919743  , -0.855170913065  , -0.828065273399  , -0.93032939891  , -0.744644008302  , -0.807707802187  , -0.775337689817  , -0.857363682194  , -0.768855142296  , -0.828773367782  , -0.945572433891  , -0.918236888471  , -0.6496974662  , -0.776716088778  , -0.523467102278  , -0.511142843937  , -0.598285389221  , -0.532047700059  , -0.484199110146  , -0.65463981827  , -0.786726163339  , -0.820846977265  , -0.918289980289  , -1.046894854954  , -1.115829628813 );
                        votes[2] += dot(x,   0.006116871597  , -0.030949784237  , -0.067826265251  , -0.085917697923  , -0.121094889584  , -0.145328638549  , -0.198611816526  , -0.244557130175  , -0.322655722783  , -0.375468281894  , -0.459898952535  , -0.502890873006  , -0.490788089383  , -0.435636640099  , -0.398788587247  , -0.362103023334  , -0.315477813032  , -0.358038809692  , -0.364149621797  , -0.32510720383  , -0.224499346852  , -0.136908725272  , 0.042509625969  , 0.012001686002  , -0.070517377567  , -0.14475940738  , -0.216286509132  , -0.286344856832  , -0.312336544884  , -0.343505299099  , -0.349360961673  , -0.36295492375 );
                        votes[3] += dot(x,   -0.684611960861  , -0.647804991388  , -0.595898898262  , -0.593682890326  , -0.637252076974  , -0.589991597956  , -0.494707420974  , -0.612436549192  , -0.53105862796  , -0.553487327394  , -0.445063895845  , -0.618434545182  , -0.544060544277  , -0.556301316151  , -0.449026135684  , -0.530949135662  , -0.476897730505  , -0.352463598965  , -0.379047618206  , -0.637062600053  , -0.50330668431  , -0.741713412836  , -0.758926235082  , -0.645461005561  , -0.700771214643  , -0.735335906552  , -0.578546476219  , -0.478637173632  , -0.490693270543  , -0.477684628614  , -0.397742974155  , -0.367307012161 );
                        votes[4] += dot(x,   -0.179829407143  , -0.424679236195  , -0.201921082123  , -0.170265892674  , -0.258145423191  , -0.139624183363  , 0.185684188699  , 0.048459015016  , 0.033567122709  , 0.450402038287  , 0.474589583235  , 0.222780664835  , 0.490839713345  , 0.337502002826  , 0.218732941726  , 0.225262124297  , 0.423135268476  , 0.051642934892  , -0.020791834242  , 0.347724358989  , 0.158348751513  , -0.26026404111  , -0.065337182613  , -0.257533870632  , -0.470097173579  , 0.009798904662  , 0.035932194495  , -0.273504028238  , -0.051157706809  , 0.278923568818  , 0.254827540284  , 0.194733012379 );
                        votes[5] += dot(x,   0.965656256502  , 1.038415177691  , 1.00120735324  , 0.972266362343  , 0.985119575916  , 0.965952437904  , 0.88376569517  , 0.925061587173  , 0.956143892246  , 0.87301428717  , 0.866677872181  , 0.953845042604  , 0.88562863905  , 0.924186993463  , 0.941514147786  , 0.94183347428  , 0.863852020839  , 0.967372955796  , 1.000273774882  , 0.904021909755  , 0.928113471309  , 1.019525096941  , 0.926003051828  , 0.988072408752  , 1.068693136164  , 0.967867166672  , 0.970738083316  , 1.0870264371  , 1.043353181072  , 0.999625391576  , 1.030186908109  , 1.092566812344 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 6; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }