#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[6] = { -7.1397612536 ,-2.300126995695 ,-1.776538428195 ,-2.477317148743 ,-1.777538398021 ,-6.929431144533  };
                        votes[0] += dot(x,   -0.14499160716  , -0.136382541852  , -0.234390477761  , -0.14017756207  , -0.141554012673  , -0.188497664509  , -0.105391483843  , -0.125388066062  , -0.149670220606  , -0.146465805455  , -0.132264916995  , -0.14441743674  , -0.096538945026  , -0.085738553533  , -0.128121021817  , -0.221218528424  , -0.209961017025  , -0.189208470678  , -0.198634355643  , -0.255334572518  , -0.287664778366  , -0.215723425723  , -0.253944516652  , -0.229783293537  , -0.256445498732  , -0.245643812337  , -0.190877826522  , -0.247684305524  , -0.249160736666  , -0.287831382961  , -0.360558509457  , -0.439275708655 );
                        votes[1] += dot(x,   -0.13805128276  , -0.111309780621  , 0.159425960671  , -0.014722463786  , 0.050007973081  , 0.098485981304  , -0.070842129179  , -0.095527672357  , -0.024750891111  , -0.025229410682  , -0.031560251289  , -0.059750524271  , -0.139875689266  , -0.169619278395  , -0.019540623007  , 0.136738245241  , 0.085397747498  , -0.036201356298  , -0.048465762942  , 0.090189814359  , 0.093207543187  , -0.067214029362  , -0.086548861028  , -0.032045366618  , -0.011597778442  , -0.045804282729  , -0.188529408871  , -0.122881490829  , -0.182646929844  , -0.185270367532  , -0.193389909588  , -0.185208306755 );
                        votes[2] += dot(x,   0.146540632631  , 0.026475024434  , 0.007024727467  , 0.00856961475  , -0.023398627243  , 0.042283301525  , -0.068472006695  , 0.023522581453  , -0.016472173202  , -0.015044193103  , -0.084554161032  , 0.026253895108  , -0.010151333033  , 0.035269108878  , -0.050885390577  , 0.039797618441  , -0.044152379565  , -0.052685883472  , 0.041600832081  , -0.010177652028  , 0.017013055758  , -0.073061382333  , 0.100998332067  , -0.042995006511  , -0.00596470735  , -0.13143015948  , -0.131911940871  , -0.007788050975  , -0.111586879066  , -0.073284900474  , -0.234955457508  , -0.103340571111 );
                        votes[3] += dot(x,   0.256754122533  , 0.167077949679  , 0.212957229608  , 0.169150290672  , 0.157300140201  , 0.149745574017  , 0.10759127977  , 0.10862316937  , 0.128979911802  , 0.051640808541  , 0.063043206972  , 0.065912768185  , 0.032092867106  , -0.004280976104  , -0.001197316316  , -0.013743328937  , -0.055723043854  , -0.027518335057  , -0.039792812835  , -0.03304065067  , -0.038994183289  , -0.084441017667  , -0.008876737585  , 0.030221720273  , 0.009483482904  , 0.048452942929  , 0.060955186511  , 0.067085901356  , 0.053952229684  , 0.067929581211  , 0.086252472634  , -0.002159305532 );
                        votes[4] += dot(x,   0.15635051956  , 0.127027963648  , 0.028021278324  , 0.034576555023  , -0.041474430729  , -0.02888080501  , -0.01923349121  , 0.050933065358  , 0.10478627111  , 0.035171559139  , -0.077207865023  , -0.078613733646  , -0.125749040298  , -0.206513690032  , -0.148712048032  , -0.108731803887  , -0.080766477585  , -0.022838182075  , -0.071865582133  , -0.035227038967  , 0.057174507492  , 0.029118157424  , 0.016214010019  , -0.018878746456  , -0.012715970988  , -0.037006236542  , -0.116868731138  , -0.047537007112  , 0.099312060167  , 0.218248298428  , 0.517760442132  , 0.57780466037 );
                        votes[5] += dot(x,   0.059397075109  , 0.103533108913  , 0.091091564527  , 0.10114140267  , 0.102897006512  , 0.09695882138  , 0.109648333802  , 0.102126402527  , 0.097937082365  , 0.1471791614  , 0.147567829676  , 0.150188970252  , 0.159650413903  , 0.19938143757  , 0.189873154598  , 0.199060382664  , 0.219942542714  , 0.211811167823  , 0.232595214263  , 0.235622756904  , 0.242651661837  , 0.277560667662  , 0.249231086213  , 0.253414671337  , 0.262062581064  , 0.257975450604  , 0.265336830473  , 0.261558623107  , 0.264505515287  , 0.271543649616  , 0.280298067016  , 0.355188250491 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 6; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 32);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 32; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }