#pragma once
#include <cstdarg>
namespace Eloquent {
    namespace ML {
        namespace Port {
            class LogisticRegression {
                public:
                    /**
                    * Predict class for features vector
                    */
                    int predict(float *x) {
                        float votes[4] = { -0.233126976383 ,-0.163760244072 ,0.175562898852 ,0.221324321603  };
                        votes[0] += dot(x,   0.013450098905  , -0.166972693275  , 0.042316430264  , 0.051142246504  , 0.031211200406  , 0.002576693973  , 0.300731940883  , -0.33402041068  , -0.183001315903  , 0.281900170117  , -0.905596589816  , 0.369277304516  , -0.084858947577  , 0.319039205626  , 0.407097048788  , 0.166292258395  , 1.486884973483  , -0.787647637174  , 0.031292039506  , 0.525045395577  , -0.391422809802  , 0.125895577415  , -0.023469372072  , 0.453625095477  , 0.054146439461  , 0.257809857927  , 0.491354434627  , 0.070427468688  , 0.234768639217  , -0.04748545632  , 0.255006733882  , 0.510271773388  , -0.111253101299  , 0.27685207806  , 0.477000138959  , -0.128431400884  , 0.148418183701  , 0.371110831729  , -0.058807701345  , 0.188347579599  , 0.333733144124  , -0.045708540423 );
                        votes[1] += dot(x,   0.137885093275  , 0.113394155272  , -0.019276374263  , 0.063857428321  , 0.238755828129  , -0.249287298065  , 0.329665819057  , -0.310338293452  , 0.682564250242  , 0.492875012965  , 0.69950382898  , 0.358673746559  , 0.427445738784  , -0.496268557526  , -1.01519540563  , 0.046475594202  , -0.842894623866  , -0.08090004835  , -0.220383650042  , -0.634252389786  , 0.138934167477  , -0.172711512661  , -0.257564931324  , 0.931865328301  , -0.208555033152  , -0.398278408859  , 0.313345557457  , 0.140787193193  , -0.245745407579  , -0.293811948895  , 0.189420808291  , 0.017852471605  , 0.011139475644  , 0.068726374404  , -0.012011684926  , -0.060676855981  , 0.006611552742  , 0.203394749431  , 0.236495351368  , 0.007746578538  , 0.114009418238  , 0.136448619799 );
                        votes[2] += dot(x,   -0.192809975096  , 0.095366730135  , 0.174247343849  , -0.105124278004  , -0.16203400554  , 0.276449663963  , -0.411929790291  , 0.910150013044  , 0.221033956476  , -0.294168553956  , -0.025376069694  , -0.3786521355  , 0.14852178873  , -0.13948596998  , 0.683403302323  , 0.182745080554  , -0.345645264873  , -0.697091316633  , 0.101498838194  , 0.538481975996  , -0.478784454455  , -0.390904005918  , 0.116811362497  , 0.730901604766  , -0.515900920264  , -0.151054357568  , 0.373079236369  , -0.435089932582  , -0.015975131986  , -0.160121451808  , -0.267741995364  , -0.201943632195  , 0.014105445396  , -0.146505168189  , -0.315491738279  , 0.106074105266  , -0.080688895786  , -0.356267290407  , -0.367287625762  , -0.143512810175  , -0.185678892852  , 0.137159763784 );
                        votes[3] += dot(x,   0.041474782916  , -0.041788192131  , -0.197287399851  , -0.00987539682  , -0.107933022995  , -0.029739059872  , -0.218467969649  , -0.265791308912  , -0.720596890815  , -0.480606629127  , 0.23146883053  , -0.349298915574  , -0.491108579936  , 0.316715321881  , -0.075304945481  , -0.39551293315  , -0.298345084744  , 1.565639002157  , 0.087592772343  , -0.429274981787  , 0.73127309678  , 0.437719941164  , 0.1642229409  , -2.116392028544  , 0.670309513955  , 0.2915229085  , -1.177779228453  , 0.223875270702  , 0.026951900348  , 0.501418857023  , -0.17668554681  , -0.326180612797  , 0.086008180259  , -0.199073284274  , -0.149496715754  , 0.0830341516  , -0.074340840657  , -0.218238290753  , 0.18959997574  , -0.052581347963  , -0.262063669511  , -0.22789984316 );
                        // return argmax of votes
                        uint8_t classIdx = 0;
                        float maxVotes = votes[0];

                        for (uint8_t i = 1; i < 4; i++) {
                            if (votes[i] > maxVotes) {
                                classIdx = i;
                                maxVotes = votes[i];
                            }
                        }

                        return classIdx;
                    }

                protected:
                    /**
                    * Compute dot product
                    */
                    float dot(float *x, ...) {
                        va_list w;
                        va_start(w, 42);
                        float dot = 0.0;

                        for (uint16_t i = 0; i < 42; i++) {
                            const float wi = va_arg(w, double);
                            dot += x[i] * wi;
                        }

                        return dot;
                    }
                };
            }
        }
    }